<div class="module" appContainerBreakpoints>
  <div class="module-header">
    <div class="module-title-bar">
      <div class="module-title">Gene Import Wizard</div>
    </div>
  </div>
  <div id="gene-import-body">
    <mat-horizontal-stepper linear="true" #stepper>
      <!-- Begin change default icons -->
      <ng-template matStepperIcon="edit">
        <i class="fa fa-pencil"></i>
      </ng-template>

      <ng-template matStepperIcon="done">
        <i class="fa fa-check"></i>
      </ng-template>

      <!-- Begin change default icons -->

      <!-- Begin changed step icons -->
      <ng-template matStepperIcon="upload">
        <i class="fa fa-file-excel-o"></i>
      </ng-template>

      <ng-template matStepperIcon="select-sheet">
        <i class="fa fa-clone"></i>
      </ng-template>

      <ng-template matStepperIcon="configure">
        <i class="fa fa-gears"></i>
      </ng-template>

      <ng-template matStepperIcon="review">
        <i class="fa fa-rocket"></i>
      </ng-template>
      <!-- End changed step icons -->

      <mat-step state="upload" [completed]="importFileForm.valid && !loadingSheet">
        <ng-template matStepLabel>Choose Import File</ng-template>
        <div class="d-flex justify-content-between mb-2">
          <a routerLink="/kg-import">
            <button class="btn btn-primary">Back</button>
          </a>
          <button class="btn btn-primary" [disabled]="!importFileForm.valid || loadingSheet || !worksheetData" matStepperNext>Next</button>
        </div>
        <app-generic-file-upload
          [resetFileInputSubject]="resetFileInputSubject"
          [accept]="acceptedFileTypes"
          (fileChanged)="onFileChange($event)"
        ></app-generic-file-upload>
        <div *ngIf="loadingSheet" class="mt-3">
          <div class="row">
            <div class="col d-flex justify-content-center text-center">
              <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading worksheet...</span>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col d-flex justify-content-center text-center">Loading worksheet...</div>
          </div>
        </div>
      </mat-step>

      <mat-step state="select-sheet" [completed]="sheetForm.valid">
        <ng-template matStepLabel>Choose Sheet</ng-template>
        <div class="d-flex justify-content-between mb-2">
          <button class="btn btn-primary" matStepperPrevious>Back</button>
          <button class="btn btn-primary" [disabled]="!(sheetForm.valid)" matStepperNext>Next</button>
        </div>
        <div *ngIf="worksheetData" class="form-group" [formGroup]="sheetForm">
          <label>Please select the sheet you would like to import:</label>
          <div class="row">
            <div class="col-md-4">
              <select class="custom-select" required formControlName="sheet" (change)="onSheetNameChange()">
                <option value="null" disabled selected hidden>Worksheet</option>
                <option *ngFor="let sheet of worksheetData.sheets" [ngValue]="sheet">{{ sheet.sheetName }}</option>
              </select>
            </div>
            <div class="col-md-6">
              <!-- TODO LL-1201: Need to add a validation regex to this so we can prevent weird labels from being added -->
              <input type="text" class="form-control" formControlName="worksheetNodeName" placeholder="Worksheet Node Name">
              <small class="form-text text-muted">
                When we create the worksheet node in the KG which represents this sheet, we will give it this name.
              </small>
            </div>
          </div>
        </div>
      </mat-step>

      <mat-step state="configure" [completed]="geneConfigFormValid">
        <ng-template matStepLabel>Configure Import Data</ng-template>
        <div class="d-flex justify-content-between mb-2">
          <button class="btn btn-primary" matStepperPrevious>Back</button>
          <button
            class="btn btn-primary"
            [disabled]="!geneConfigFormValid"
            (click)="importGeneRelationships()"
            matStepperNext
          >Import Relationships</button>
        </div>
        <h3>Sheet Slice</h3>
        <app-worksheet-preview
          [worksheetData]="selectedSheet"
        ></app-worksheet-preview>
        <app-gene-import-config
          [worksheetData]="selectedSheet"
          (relationshipFormValidityChanged)="onRelationshipFormValidityChanged($event)"
          (relationshipsChanged)="onRelationshipsChanged($event)"
        ></app-gene-import-config>
      </mat-step>

      <mat-step state="review" [completed]="false">
        <ng-template matStepLabel>Review Data Import</ng-template>
        <div class="d-flex justify-content-between mb-2">
          <button class="btn btn-primary" matStepperPrevious>Back</button>
          <a routerLink="/kg-import"><button class="btn btn-primary">Done</button></a>
        </div>
        <!-- TODO: Some component that lets the user explore the unmatched results -->
        <div *ngIf="importingRelationships" class="mt-3">
          <div class="row">
            <div class="col d-flex justify-content-center text-center">
              <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Importing...</span>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col d-flex justify-content-center text-center">Importing...</div>
          </div>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
</div>
